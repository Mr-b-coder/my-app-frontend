# üåì Theme Toggle Documentation

> Complete guide to implementing light/dark mode theming in your application using the Acutrack Design System.

---

## Table of Contents

1. [Overview](#overview)
2. [Quick Start](#quick-start)
3. [How It Works](#how-it-works)
4. [Theme Toggle Components](#theme-toggle-components)
5. [Component-Level vs App-Level Theming](#component-level-vs-app-level-theming)
6. [Color Tokens Reference](#color-tokens-reference)
7. [Making Custom Components Theme-Aware](#making-custom-components-theme-aware)
8. [API Reference](#api-reference)
9. [Examples](#examples)
10. [Troubleshooting](#troubleshooting)

---

## Overview

The Acutrack Design System provides a **class-based dark mode** implementation using Tailwind CSS. The theme system supports:

- ‚úÖ Light and Dark modes
- ‚úÖ User preference persistence (localStorage)
- ‚úÖ System preference detection (OS-level dark/light mode)
- ‚úÖ Component-level theme overrides
- ‚úÖ Multiple theme toggle components for different use cases

---

## Quick Start

### Step 1: Import the CSS

```tsx
import '@acutrack-bookprint/acutrack-ds/dist/style.css';
```

### Step 2: Add a Theme Toggle

```tsx
import { ThemeToggle } from '@acutrack-bookprint/acutrack-ds';

function App() {
  return (
    <div className="min-h-screen bg-bg-primary dark:bg-dark-bg-primary">
      <header className="p-4 flex justify-end">
        <ThemeToggle />
      </header>
      <main className="p-8">
        <h1 className="text-text-primary dark:text-dark-text-primary">
          Hello World!
        </h1>
      </main>
    </div>
  );
}
```

That's it! The theme toggle will:
- Use **light** mode on **first visit** (no system preference on first load)
- Save user's choice to localStorage when they toggle
- Apply the stored preference immediately on subsequent visits

---

## How It Works

### The Core Mechanism

The theme system works by toggling a `dark` class on the `<html>` element:

```html
<!-- Light Mode -->
<html class="light">
  ...
</html>

<!-- Dark Mode -->
<html class="dark">
  ...
</html>
```

### Theme Priority Order (v1.0.93+)

When determining which theme to use, the system checks in this order:

| Priority | Source | Description |
|----------|--------|-------------|
| 1Ô∏è‚É£ | localStorage | User's saved preference from previous visits |
| 2Ô∏è‚É£ | First visit default | If no stored value, use **light** (no system preference on first load) |

**Note:** As of v1.0.93, the initial theme on first visit is always **light**; system preference (`prefers-color-scheme`) is no longer used for the first load. After the user toggles, their choice is stored and used on subsequent visits.

### Initialization Flow

```
User visits site
       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Check localStorage('theme') ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚Üì
   Has value?
    /     \
  Yes      No (first visit)
   ‚Üì        ‚Üì
Use it   Use 'light'
```

---

## Theme Toggle Components

The design system provides three theme toggle components for different contexts:

### 1. `ThemeToggle` ‚Äî Standalone Component

A standalone button that can be placed anywhere in your app.

```tsx
import { ThemeToggle } from '@acutrack-bookprint/acutrack-ds';

<ThemeToggle />
<ThemeToggle className="my-custom-class" />
```

**Features:**
- Shows current theme icon (sun/moon)
- Displays theme label ("Light" / "Dark")
- Fully accessible with ARIA labels

---

### 2. `Sidebar.ThemeToggle` ‚Äî For Sidebars

Designed specifically for use within the Sidebar component. Adapts to collapsed/expanded states.

```tsx
import { Sidebar } from '@acutrack-bookprint/acutrack-ds';

<Sidebar>
  <Sidebar.Header>
    <Sidebar.Logo />
  </Sidebar.Header>
  <Sidebar.Navigation>
    {/* Navigation items */}
  </Sidebar.Navigation>
  <Sidebar.Footer>
    <Sidebar.ThemeToggle />  {/* Theme toggle in footer */}
  </Sidebar.Footer>
</Sidebar>
```

**Features:**
- Shows only icon when sidebar is collapsed
- Shows icon + label when sidebar is expanded
- Respects sidebar theme (can have fixed sidebar while toggling app theme)

---

### 3. `Header.ThemeSwitcher` ‚Äî For Headers

Designed for use within the Header component.

```tsx
import { Header } from '@acutrack-bookprint/acutrack-ds';

<Header>
  <Header.Logo />
  <Header.Navigation>
    {/* Nav items */}
  </Header.Navigation>
  <Header.Actions>
    <Header.ThemeSwitcher />
  </Header.Actions>
</Header>
```

**Features:**
- Icon-only design (sun/moon)
- Compact for header use
- Matches header theme styling

---

## Component-Level vs App-Level Theming

The design system supports two levels of theming:

### App-Level Theming

Controls the overall light/dark appearance of your application. This is what the theme toggle switches.

```tsx
// Main content responds to app theme
<main className="bg-bg-primary dark:bg-dark-bg-primary">
  <p className="text-text-primary dark:text-dark-text-primary">
    This text changes color with the theme toggle
  </p>
</main>
```

### Component-Level Theming

Individual components (Sidebar, Header, Footer) can have their own fixed theme that doesn't change with the app theme.

```tsx
// Sidebar with fixed "brand" theme (always navy)
<Sidebar theme="brand">
  <Sidebar.ThemeToggle />  {/* Still toggles app theme for main content */}
</Sidebar>

// Header follows app theme
<Header theme="default">
  ...
</Header>
```

**Available component themes:**
- `'default'` ‚Äî Follows app-level light/dark theme
- `'brand'` ‚Äî Fixed navy blue theme
- `'minimal'` ‚Äî Fixed light/white theme
- `'grey'` ‚Äî Fixed dark grey theme
- `'dark'` ‚Äî Fixed dark theme
- `'custom'` ‚Äî Custom colors via `customColors` prop

### Mixed Theme Example

```tsx
function Dashboard() {
  return (
    <div className="flex min-h-screen">
      {/* Sidebar stays navy regardless of app theme */}
      <Sidebar theme="brand">
        <Sidebar.Header>
          <Sidebar.Logo />
        </Sidebar.Header>
        <Sidebar.Navigation>
          <Sidebar.NavItem href="/dashboard" icon="dashboard">
            Dashboard
          </Sidebar.NavItem>
        </Sidebar.Navigation>
        <Sidebar.Footer>
          <Sidebar.ThemeToggle />  {/* Toggles main content theme */}
        </Sidebar.Footer>
      </Sidebar>

      {/* Main content follows app theme */}
      <main className="flex-1 bg-bg-primary dark:bg-dark-bg-primary">
        <Header theme="default">  {/* Header follows app theme */}
          <Header.Logo />
        </Header>
        
        <div className="p-8">
          <h1 className="text-text-primary dark:text-dark-text-primary">
            Welcome to Dashboard
          </h1>
        </div>
      </main>
    </div>
  );
}
```

---

## Color Tokens Reference

### Light Mode Colors

| Token | CSS Class | Value | Usage |
|-------|-----------|-------|-------|
| Text Primary | `text-text-primary` | `#1B3A7B` | Headings, important text |
| Text Secondary | `text-text-secondary` | `#3C4858` | Body text, descriptions |
| Background Primary | `bg-bg-primary` | `#f6f7fa` | Page background |
| Background Secondary | `bg-bg-secondary` | `#FFFFFF` | Cards, modals |
| Background Tertiary | `bg-bg-tertiary` | `#ebeff9` | Hover states, subtle backgrounds |
| Border | `border-border-color` | `#DFE4E9` | Borders, dividers |

### Dark Mode Colors

| Token | CSS Class | Value | Usage |
|-------|-----------|-------|-------|
| Text Primary | `dark:text-dark-text-primary` | `#F6F8FD` | Headings, important text |
| Text Secondary | `dark:text-dark-text-secondary` | `#9CA3AF` | Body text, descriptions |
| Background Primary | `dark:bg-dark-bg-primary` | `#1c212c` | Page background |
| Background Secondary | `dark:bg-dark-bg-secondary` | `#101620` | Cards, modals |
| Background Tertiary | `dark:bg-dark-bg-tertiary` | `#1e2a3a` | Hover states, subtle backgrounds |
| Border | `dark:border-dark-border-color` | `#1c3332` | Borders, dividers |

### Brand Colors

| Token | Light Mode | Dark Mode |
|-------|------------|-----------|
| Brand Navy | `#1B3A7B` | `#53e3cb` |
| Brand Orange | `#0d9488` | `#0d9488` |
| Brand Orange Hover | `#0a6960` | `#5eead4` |

---

## Making Custom Components Theme-Aware

When building your own components, follow this pattern:

### Basic Pattern

Always provide both light and dark variants:

```tsx
// ‚úÖ Correct - provides both variants
<div className="bg-bg-secondary dark:bg-dark-bg-secondary">
  <h2 className="text-text-primary dark:text-dark-text-primary">
    Title
  </h2>
  <p className="text-text-secondary dark:text-dark-text-secondary">
    Description
  </p>
</div>

// ‚ùå Incorrect - only works in one theme
<div className="bg-white">
  <h2 className="text-gray-900">Title</h2>
</div>
```

### Complete Component Example

```tsx
interface CardProps {
  title: string;
  description: string;
  children?: React.ReactNode;
}

export const Card: React.FC<CardProps> = ({ title, description, children }) => {
  return (
    <div className="
      bg-bg-secondary dark:bg-dark-bg-secondary
      border border-border-color dark:border-dark-border-color
      rounded-lg p-6 shadow-sm
      transition-colors duration-200
    ">
      <h3 className="text-lg font-semibold text-text-primary dark:text-dark-text-primary mb-2">
        {title}
      </h3>
      <p className="text-text-secondary dark:text-dark-text-secondary mb-4">
        {description}
      </p>
      {children}
    </div>
  );
};
```

### Form Input Example

```tsx
export const Input: React.FC<InputProps> = ({ label, ...props }) => {
  return (
    <div>
      <label className="block text-sm font-medium text-text-primary dark:text-dark-text-primary mb-1">
        {label}
      </label>
      <input
        className="
          w-full px-3 py-2
          bg-bg-secondary dark:bg-dark-bg-secondary
          border border-border-color dark:border-dark-border-color
          text-text-primary dark:text-dark-text-primary
          placeholder:text-text-secondary dark:placeholder:text-dark-text-secondary
          rounded-md
          focus:outline-none focus:ring-2 focus:ring-brand-orange
          transition-colors duration-200
        "
        {...props}
      />
    </div>
  );
};
```

---

## API Reference

### ThemeToggle

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `className` | `string` | `""` | Additional CSS classes |

### Sidebar.ThemeToggle

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `className` | `string` | `""` | Additional CSS classes |

*Note: Inherits context from parent Sidebar component*

### Header.ThemeSwitcher

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `className` | `string` | `""` | Additional CSS classes |

*Note: Inherits context from parent Header component*

### Theme Events

The theme system dispatches a custom event when the theme changes:

```tsx
// Listen for theme changes
window.addEventListener('themeChanged', () => {
  console.log('Theme was changed!');
  const isDark = document.documentElement.classList.contains('dark');
  // Do something with the new theme state
});
```

### Programmatic Theme Control

```tsx
// Set theme programmatically
const setTheme = (theme: 'light' | 'dark') => {
  const html = document.documentElement;
  html.classList.toggle('dark', theme === 'dark');
  html.classList.toggle('light', theme === 'light');
  localStorage.setItem('theme', theme);
  window.dispatchEvent(new CustomEvent('themeChanged'));
};

// Get current theme
const getCurrentTheme = (): 'light' | 'dark' => {
  return document.documentElement.classList.contains('dark') ? 'dark' : 'light';
};
```

---

## Examples

### Example 1: Simple App with Theme Toggle

```tsx
import { ThemeToggle, Button, Card } from '@acutrack-bookprint/acutrack-ds';

function App() {
  return (
    <div className="min-h-screen bg-bg-primary dark:bg-dark-bg-primary p-8">
      <div className="max-w-4xl mx-auto">
        <header className="flex justify-between items-center mb-8">
          <h1 className="text-2xl font-bold text-text-primary dark:text-dark-text-primary">
            My App
          </h1>
          <ThemeToggle />
        </header>
        
        <Card>
          <h2 className="text-xl font-semibold text-text-primary dark:text-dark-text-primary mb-4">
            Welcome!
          </h2>
          <p className="text-text-secondary dark:text-dark-text-secondary mb-4">
            This card automatically adapts to the current theme.
          </p>
          <Button variant="primary">Get Started</Button>
        </Card>
      </div>
    </div>
  );
}
```

### Example 2: Dashboard with Sidebar

```tsx
import { Sidebar, Header, Card } from '@acutrack-bookprint/acutrack-ds';

function Dashboard() {
  return (
    <div className="flex min-h-screen">
      <Sidebar theme="default" collapsible>
        <Sidebar.Header>
          <Sidebar.Logo />
        </Sidebar.Header>
        
        <Sidebar.Navigation>
          <Sidebar.NavGroup title="Main" icon="apps">
            <Sidebar.NavItem href="/dashboard" icon="dashboard" isActive>
              Dashboard
            </Sidebar.NavItem>
            <Sidebar.NavItem href="/analytics" icon="analytics">
              Analytics
            </Sidebar.NavItem>
          </Sidebar.NavGroup>
        </Sidebar.Navigation>
        
        <Sidebar.Footer>
          <Sidebar.ThemeToggle />
          <Sidebar.UserDetails name="John Doe" email="john@example.com" />
        </Sidebar.Footer>
      </Sidebar>
      
      <main className="flex-1 bg-bg-primary dark:bg-dark-bg-primary">
        <Header theme="default" sticky>
          <Header.Breadcrumbs items={[
            { label: 'Home', href: '/' },
            { label: 'Dashboard', isActive: true }
          ]} />
          <Header.Actions>
            <Header.Notifications count={3} />
          </Header.Actions>
        </Header>
        
        <div className="p-8">
          <h1 className="text-2xl font-bold text-text-primary dark:text-dark-text-primary mb-6">
            Dashboard
          </h1>
          
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            <Card>
              <p className="text-text-secondary dark:text-dark-text-secondary">
                Total Users
              </p>
              <p className="text-3xl font-bold text-text-primary dark:text-dark-text-primary">
                1,234
              </p>
            </Card>
            {/* More cards... */}
          </div>
        </div>
      </main>
    </div>
  );
}
```

### Example 3: Fixed Sidebar Theme with App Theme Toggle

```tsx
import { Sidebar, Header } from '@acutrack-bookprint/acutrack-ds';

function App() {
  return (
    <div className="flex min-h-screen">
      {/* Sidebar stays brand navy - doesn't change with toggle */}
      <Sidebar theme="brand">
        <Sidebar.Header>
          <Sidebar.Logo />
        </Sidebar.Header>
        <Sidebar.Navigation>
          {/* ... */}
        </Sidebar.Navigation>
        <Sidebar.Footer>
          {/* This toggle changes the main content area only */}
          <Sidebar.ThemeToggle />
        </Sidebar.Footer>
      </Sidebar>
      
      {/* Main content responds to theme toggle */}
      <main className="flex-1 bg-bg-primary dark:bg-dark-bg-primary">
        <Header theme="default">
          <Header.Logo text="My App" />
        </Header>
        <div className="p-8">
          <p className="text-text-primary dark:text-dark-text-primary">
            This content changes between light and dark!
          </p>
        </div>
      </main>
    </div>
  );
}
```

---

## Troubleshooting

### Theme not persisting after refresh

**Cause:** localStorage might not be available or is being blocked.

**Solution:** Check browser settings for localStorage access, especially in private/incognito mode.

### Flash of wrong theme on page load

**Cause:** React hydration happens after initial render.

**Solution:** Add this script to your `index.html` before any content:

```html
<script>
  (function() {
    const theme = localStorage.getItem('theme');
    if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.add('light');
    }
  })();
</script>
```

### Dark mode styles not applying

**Cause:** Missing `darkMode: 'class'` in Tailwind config.

**Solution:** Ensure your `tailwind.config.js` includes:

```js
module.exports = {
  darkMode: 'class',
  // ...
}
```

### Component not responding to theme

**Cause:** Missing `dark:` variants in class names.

**Solution:** Add dark mode variants to all color-related classes:

```tsx
// Before
<div className="bg-white text-gray-900">

// After
<div className="bg-bg-secondary dark:bg-dark-bg-secondary text-text-primary dark:text-dark-text-primary">
```

### Logo not updating with theme

**Cause:** Logo component not receiving theme change event.

**Solution:** The Logo components in Header, Sidebar, and Footer automatically listen for the `themeChanged` event. If using a custom logo, listen for the event:

```tsx
useEffect(() => {
  const handleThemeChange = () => {
    const isDark = document.documentElement.classList.contains('dark');
    setLogo(isDark ? darkLogo : lightLogo);
  };
  
  window.addEventListener('themeChanged', handleThemeChange);
  return () => window.removeEventListener('themeChanged', handleThemeChange);
}, []);
```

---

## Best Practices

1. **Always provide both variants** ‚Äî Every color class should have a `dark:` counterpart

2. **Use semantic color tokens** ‚Äî Use `text-primary` instead of `text-blue-900`

3. **Group theme classes together** ‚Äî Keep related light/dark classes adjacent for readability

4. **Test both themes** ‚Äî Always verify your UI looks correct in both light and dark modes

5. **Consider contrast ratios** ‚Äî Ensure text is readable in both themes (WCAG AA compliance)

6. **Add smooth transitions** ‚Äî Use `transition-colors duration-200` for smooth theme switches

---

## Related Documentation

- [Theme Implementation Guide](./THEME_IMPLEMENTATION_GUIDE.md)
- [Sidebar Component Guide](../components/SIDEBAR_COMPONENT_USAGE_GUIDE.md)
- [Header Component Guide](../components/HEADER_COMPONENT_USAGE_GUIDE.md)
- [Footer Component Guide](../components/FOOTER_COMPONENT_USAGE_GUIDE.md)

---

**Need help?** Open an issue in the repository or contact the design system team.





