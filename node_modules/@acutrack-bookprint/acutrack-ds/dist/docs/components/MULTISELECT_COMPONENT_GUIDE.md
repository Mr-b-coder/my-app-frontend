# MultiSelect Component - Comprehensive Guide

## Overview

The MultiSelect component provides an advanced multi-selection interface with chips, search functionality, and comprehensive filtering capabilities. It's designed for scenarios where users need to select multiple items from a large list of options.

## Features

### ✅ Core Features
- **Multiple selection** with visual chips
- **Real-time search** and filtering
- **Keyboard navigation** (Arrow keys, Enter, Escape, Backspace)
- **Multiple sizes and variants** (xs, sm, md, lg, xl)
- **Color themes** (primary, success, warning, danger, info)
- **Option icons and descriptions** support
- **Select All / Clear All** functionality
- **Max selections limit** with user feedback
- **Auto-adjusting height** for chips display

### ✅ Advanced Features
- **Industry-standard API** with simplified props
- **Design system integration** with proper color tokens
- **Dark mode support** with consistent theming
- **Accessibility features** with proper ARIA attributes
- **Dropdown overflow protection** (z-index: 9999)
- **State management** with proper error handling
- **Responsive design** with screen-friendly layouts

## Installation & Import

```typescript
import { MultiSelect } from '@acutrack-bookprint/acutrack-ds';
import type { MultiSelectProps, MultiSelectSize, MultiSelectVariant, MultiSelectColor } from '@acutrack-bookprint/acutrack-ds';
```

## Basic Usage

```typescript
import React, { useState } from 'react';
import { MultiSelect } from '@acutrack-bookprint/acutrack-ds';

const MyComponent = () => {
  const [selectedValues, setSelectedValues] = useState<(string | number)[]>([]);

  const options = [
    { value: 'react', label: 'React', description: 'JavaScript library' },
    { value: 'vue', label: 'Vue.js', description: 'Progressive framework' },
    { value: 'angular', label: 'Angular', description: 'TypeScript framework' }
  ];

  return (
    <MultiSelect
      label="Select Technologies"
      options={options}
      value={selectedValues}
      onChange={setSelectedValues}
      placeholder="Choose technologies..."
      searchable={true}
      showChips={true}
      clearable={true}
    />
  );
};
```

## Props Reference

### Required Props

| Prop | Type | Description |
|------|------|-------------|
| `label` | `string` | The label text displayed above the multiselect field |
| `options` | `SelectOption[]` | Array of options to display in the dropdown |
| `value` | `(string \| number)[]` | Array of currently selected values |
| `onChange` | `(values: (string \| number)[]) => void` | Callback function when the selection changes |

### Optional Props

#### Appearance & Styling
| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `size` | `MultiSelectSize` | `'md'` | Size of the multiselect field (xs, sm, md, lg, xl) |
| `variant` | `MultiSelectVariant` | `'primary'` | Visual variant (primary, secondary, outline, ghost, filled) |
| `color` | `MultiSelectColor` | `'primary'` | Color theme (primary, success, warning, danger, info) |
| `placeholder` | `string` | `'Select options...'` | Placeholder text for the input field |
| `position` | `DropdownPosition` | `'bottom-start'` | Position of the dropdown relative to the input |

#### State & Behavior
| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `disabled` | `boolean` | `false` | Whether the multiselect field is disabled |
| `loading` | `boolean` | `false` | Whether the multiselect field is in a loading state |
| `required` | `boolean` | `false` | Whether the multiselect field is required |
| `error` | `string` | `undefined` | Error message to display below the field |
| `helpText` | `string` | `undefined` | Helper text to display below the field |

#### Display Options
| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `searchable` | `boolean` | `true` | Whether to show a search input |
| `showChips` | `boolean` | `true` | Whether to show selected items as chips/tags |
| `clearable` | `boolean` | `false` | Whether to show a clear all button |
| `selectAll` | `boolean` | `false` | Whether to show a select all button |
| `maxSelections` | `number` | `undefined` | Maximum number of selections allowed |

#### Callbacks
| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `onSelect` | `(option: SelectOption) => void` | `undefined` | Callback when an option is selected |
| `onDeselect` | `(option: SelectOption) => void` | `undefined` | Callback when an option is deselected |

#### Styling & Customization
| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `className` | `string` | `undefined` | Additional CSS classes for the container |
| `style` | `React.CSSProperties` | `undefined` | Inline styles for the component |

## Advanced Usage Examples

### 1. With Icons and Descriptions

```typescript
import React, { useState } from 'react';
import { MultiSelect } from '@acutrack-bookprint/acutrack-ds';
import { Icon } from '@acutrack-bookprint/acutrack-ds';

const TechStackSelector = () => {
  const [selectedTechs, setSelectedTechs] = useState<(string | number)[]>([]);

  const techOptions = [
    { 
      value: 'react', 
      label: 'React', 
      icon: <Icon size="sm">code</Icon>,
      description: 'JavaScript library'
    },
    { 
      value: 'vue', 
      label: 'Vue.js', 
      icon: <Icon size="sm">view_module</Icon>,
      description: 'Progressive framework'
    },
    { 
      value: 'angular', 
      label: 'Angular', 
      icon: <Icon size="sm">extension</Icon>,
      description: 'TypeScript framework'
    }
  ];

  return (
    <MultiSelect
      label="Select Tech Stack"
      options={techOptions}
      value={selectedTechs}
      onChange={setSelectedTechs}
      placeholder="Choose technologies..."
      searchable={true}
      showChips={true}
      clearable={true}
      selectAll={true}
      showDescriptions={true}
    />
  );
};
```

### 2. With Max Selections Limit

```typescript
const SkillSelector = () => {
  const [selectedSkills, setSelectedSkills] = useState<(string | number)[]>([]);

  return (
    <MultiSelect
      label="Select Skills (Max 5)"
      options={skillOptions}
      value={selectedSkills}
      onChange={setSelectedSkills}
      maxSelections={5}
      placeholder="Choose up to 5 skills..."
      searchable={true}
      showChips={true}
      clearable={true}
      helpText="You can select up to 5 skills"
    />
  );
};
```

### 3. Minimal Configuration (No Chips)

```typescript
const CompactSelector = () => {
  const [selectedValues, setSelectedValues] = useState<(string | number)[]>([]);

  return (
    <MultiSelect
      label="Categories"
      options={categoryOptions}
      value={selectedValues}
      onChange={setSelectedValues}
      placeholder="Choose categories..."
      searchable={false}
      showChips={false}
      clearable={true}
      selectAll={false}
    />
  );
};
```

### 4. Error State with Validation

```typescript
const ValidatedSelector = () => {
  const [selectedValues, setSelectedValues] = useState<(string | number)[]>([]);
  const [error, setError] = useState<string>('');

  const handleChange = (values: (string | number)[]) => {
    setSelectedValues(values);
    
    // Validation
    if (values.length === 0) {
      setError('Please select at least one option');
    } else {
      setError('');
    }
  };

  return (
    <MultiSelect
      label="Required Selection"
      options={options}
      value={selectedValues}
      onChange={handleChange}
      required={true}
      error={error}
      placeholder="Select at least one option..."
      searchable={true}
      showChips={true}
      clearable={true}
    />
  );
};
```

### 5. Color Themes

```typescript
const ThemedSelectors = () => {
  const [primaryValues, setPrimaryValues] = useState<(string | number)[]>([]);
  const [successValues, setSuccessValues] = useState<(string | number)[]>([]);
  const [warningValues, setWarningValues] = useState<(string | number)[]>([]);

  return (
    <div className="space-y-4">
      {/* Primary Theme */}
      <MultiSelect
        label="Primary Theme"
        options={options}
        value={primaryValues}
        onChange={setPrimaryValues}
        color="primary"
        searchable={true}
        showChips={true}
      />

      {/* Success Theme */}
      <MultiSelect
        label="Success Theme"
        options={options}
        value={successValues}
        onChange={setSuccessValues}
        color="success"
        searchable={true}
        showChips={true}
      />

      {/* Warning Theme */}
      <MultiSelect
        label="Warning Theme"
        options={options}
        value={warningValues}
        onChange={setWarningValues}
        color="warning"
        searchable={true}
        showChips={true}
      />
    </div>
  );
};
```

## Design System Integration

### Color Themes
The MultiSelect component uses design system color tokens:

```typescript
// Available colors
type MultiSelectColor = 'primary' | 'success' | 'warning' | 'danger' | 'info';

// Color mapping
'primary' → brand-orange colors
'success' → system-success colors  
'warning' → system-warning colors
'danger' → system-error colors
'info' → system-info colors
```

### Color Adaptation
Colors automatically adapt throughout the component:

```typescript
// Input field colors
border-brand-orange focus:border-brand-orange focus:ring-brand-orange

// Chip colors  
bg-brand-orange/10 text-brand-navy border-brand-orange/20

// Checkbox colors
border-brand-orange bg-brand-orange

// Select All button colors
text-brand-orange hover:underline
```

### Dark Mode Support
All colors automatically adapt to dark mode:

```typescript
// Light mode
bg-bg-secondary text-text-primary border-border-color

// Dark mode  
bg-dark-bg-secondary text-dark-text-primary border-dark-border-color
```

## Visual Features

### Chip Display
Selected items are displayed as visual chips with:

- **Color-coded backgrounds** based on the color theme
- **Remove buttons** (×) for individual deselection
- **Responsive text** with truncation for long labels
- **Auto-adjusting height** to accommodate all chips

### Checkbox Indicators
Dropdown options show:

- **Visual checkboxes** that adapt to the color theme
- **Checkmark icons** for selected options
- **Hover states** with smooth transitions
- **Professional appearance** following industry standards

### Dropdown Features
- **Search functionality** with real-time filtering
- **Select All / Clear All** buttons
- **Option icons and descriptions** support
- **Keyboard navigation** with arrow keys
- **Overflow protection** with high z-index

## Keyboard Navigation

### Supported Keys
- **Arrow Down/Up**: Navigate through options
- **Enter**: Select/deselect highlighted option
- **Escape**: Close dropdown
- **Backspace**: Remove last selected item (when input is empty)
- **Tab**: Move focus away from component

### Navigation Flow
1. **Focus input** → Type to search or use arrow keys
2. **Navigate options** → Use arrow keys to highlight
3. **Select option** → Press Enter or click
4. **Remove selection** → Click chip × or use Backspace
5. **Close dropdown** → Press Escape or click outside

## State Management

### Value Management
```typescript
const [selectedValues, setSelectedValues] = useState<(string | number)[]>([]);

// Add selection
const handleSelect = (option: SelectOption) => {
  setSelectedValues(prev => [...prev, option.value]);
};

// Remove selection
const handleDeselect = (option: SelectOption) => {
  setSelectedValues(prev => prev.filter(v => v !== option.value));
};

// Clear all
const handleClearAll = () => {
  setSelectedValues([]);
};
```

### Validation
```typescript
const validateSelection = (values: (string | number)[]) => {
  if (values.length === 0) {
    return 'Please select at least one option';
  }
  if (maxSelections && values.length > maxSelections) {
    return `Maximum ${maxSelections} selections allowed`;
  }
  return '';
};
```

## Performance Considerations

### Large Option Lists
For large option lists, consider:

```typescript
// Limit displayed options
<MultiSelect
  options={options.slice(0, 100)} // Show first 100 options
  searchable={true} // Enable search for filtering
/>

// Use virtual scrolling for very large lists
const virtualizedOptions = useMemo(() => 
  options.map(option => ({ ...option, id: option.value })), 
  [options]
);
```

### Search Optimization
Search is optimized with:

- **Debounced filtering** to prevent excessive re-renders
- **Case-insensitive matching** by default
- **Label-based filtering** for fast performance

## Accessibility Features

### ARIA Support
- **Proper labels** with `aria-label` and `aria-describedby`
- **Screen reader support** for option descriptions
- **Keyboard navigation** with proper focus management
- **Error announcements** for validation messages

### Screen Reader Experience
```typescript
<MultiSelect
  label="Select Technologies"
  options={options}
  value={selectedValues}
  onChange={setSelectedValues}
  error={error}
  helpText="Choose your preferred technologies"
  // Screen readers will announce:
  // - Label: "Select Technologies"
  // - Current selection count
  // - Error messages if any
  // - Help text for guidance
/>
```

## Troubleshooting

### Common Issues

#### 1. Dropdown Hidden Behind Other Elements
**Problem**: Dropdown appears behind other components
**Solution**: Ensure parent containers have `overflowVisible={true}`
```typescript
<Card overflowVisible={true}>
  <MultiSelect ... />
</Card>
```

#### 2. Full-Width Behavior
**Feature**: MultiSelect automatically takes full width of its parent container
**Implementation**: The component uses `w-full` by default and dropdowns use `fullWidth={true}`
```typescript
// ✅ Automatically takes full width
<div className="w-full"> {/* Parent container */}
  <MultiSelect ... /> {/* Takes full width automatically */}
</div>

// ✅ Dropdown also takes full width
<MultiSelect 
  // Dropdown automatically uses fullWidth={true}
  // No additional configuration needed
/>
```

#### 3. Chips Overflowing Container
**Problem**: Selected chips overflow the component boundaries
**Solution**: The component now auto-adjusts height, but ensure parent has proper width
```typescript
<div className="w-full"> {/* Ensure full width */}
  <MultiSelect ... />
</div>
```

#### 4. Color Changes Not Reflecting
**Problem**: Color prop changes don't affect chip colors
**Solution**: Ensure you're using the correct color values
```typescript
// ✅ Correct
<MultiSelect color="success" ... />

// ❌ Incorrect (old API)
<MultiSelect color="secondary" ... />
```

#### 5. Max Selections Not Working
**Problem**: Users can select more than maxSelections
**Solution**: Check that maxSelections is a positive number
```typescript
<MultiSelect
  maxSelections={5} // Must be a positive number
  // ... other props
/>
```

## Migration Guide

### From Previous Versions

#### Breaking Changes
- **API Simplification**: Many props renamed or removed
- **Color System**: Updated to use design system tokens
- **Chip Behavior**: Now auto-adjusts height instead of showing "more" indicator

#### Migration Steps

##### 1. Update Prop Names
```typescript
// Old API
<MultiSelect
  selectedValues={values}
  onSelectedValuesChange={setValues}
  hasSearch={true}
  hasChips={true}
  hasClearAll={true}
  isDisabled={false}
  errorMessage="Error"
  isRequired={true}
  helpText="Help"
/>

// New API
<MultiSelect
  value={values}
  onChange={setValues}
  searchable={true}
  showChips={true}
  clearable={true}
  disabled={false}
  error="Error"
  required={true}
  helpText="Help"
/>
```

##### 2. Update Color References
```typescript
// Old colors
color="secondary" // ❌ No longer supported

// New colors
color="primary"   // ✅ Brand orange
color="success"  // ✅ System success
color="warning"  // ✅ System warning
color="danger"   // ✅ System error
color="info"     // ✅ System info
```

##### 3. Remove Deprecated Props
```typescript
// Remove these props
alignment="left"     // ❌ Removed
radius="md"         // ❌ Removed
maxVisibleChips={3} // ❌ Removed (now shows all chips)
```

## Best Practices

### 1. Use Appropriate Configuration
```typescript
// ✅ Good - Full-featured for complex selections
<MultiSelect
  searchable={true}
  showChips={true}
  clearable={true}
  selectAll={true}
  maxSelections={10}
/>

// ✅ Good - Minimal for simple selections
<MultiSelect
  searchable={false}
  showChips={false}
  clearable={true}
  selectAll={false}
/>
```

### 2. Provide Rich Option Data
```typescript
// ✅ Good - Rich option data
const options = [
  { 
    value: 'react', 
    label: 'React', 
    description: 'JavaScript library for building user interfaces',
    icon: <Icon>code</Icon>
  }
];

// ❌ Avoid - Minimal option data
const options = [
  { value: 'react', label: 'React' }
];
```

### 3. Handle Loading States
```typescript
// ✅ Good - Show loading state
<MultiSelect
  loading={isLoading}
  options={isLoading ? [] : options}
  // ... other props
/>
```

### 4. Use Appropriate Sizes
```typescript
// ✅ Good - Appropriate sizing
<MultiSelect size="sm" /> // For compact forms
<MultiSelect size="lg" /> // For prominent selections
```

### 5. Implement Proper Validation
```typescript
// ✅ Good - Comprehensive validation
const validateSelection = (values: (string | number)[]) => {
  if (required && values.length === 0) {
    return 'This field is required';
  }
  if (maxSelections && values.length > maxSelections) {
    return `Maximum ${maxSelections} selections allowed`;
  }
  return '';
};
```

## Examples Gallery

### Basic MultiSelect
```typescript
<MultiSelect
  label="Select Countries"
  options={countryOptions}
  value={selectedCountries}
  onChange={setSelectedCountries}
  placeholder="Choose countries..."
/>
```

### Advanced MultiSelect with All Features
```typescript
<MultiSelect
  label="Select Skills"
  options={skillOptionsWithIcons}
  value={selectedSkills}
  onChange={setSelectedSkills}
  size="lg"
  variant="outline"
  color="success"
  searchable={true}
  showChips={true}
  clearable={true}
  selectAll={true}
  maxSelections={5}
  placeholder="Choose up to 5 skills..."
  helpText="Select your top 5 skills"
  error={validationError}
/>
```

### Form Integration
```typescript
const UserProfileForm = () => {
  const [formData, setFormData] = useState({
    name: '',
    skills: [],
    interests: []
  });

  return (
    <form>
      <MultiSelect
        label="Skills"
        options={skillOptions}
        value={formData.skills}
        onChange={(skills) => setFormData(prev => ({ ...prev, skills }))}
        maxSelections={10}
        searchable={true}
        showChips={true}
        clearable={true}
        required={true}
        error={errors.skills}
      />
      
      <MultiSelect
        label="Interests"
        options={interestOptions}
        value={formData.interests}
        onChange={(interests) => setFormData(prev => ({ ...prev, interests }))}
        searchable={true}
        showChips={true}
        clearable={true}
      />
    </form>
  );
};
```

### Dynamic Options
```typescript
const DynamicSelector = () => {
  const [selectedValues, setSelectedValues] = useState<(string | number)[]>([]);
  const [options, setOptions] = useState(initialOptions);

  const handleCreateOption = (value: string) => {
    const newOption = {
      value: value.toLowerCase().replace(/\s+/g, '-'),
      label: value,
      description: 'Custom option'
    };
    setOptions(prev => [...prev, newOption]);
    setSelectedValues(prev => [...prev, newOption.value]);
  };

  return (
    <MultiSelect
      label="Add Custom Items"
      options={options}
      value={selectedValues}
      onChange={setSelectedValues}
      searchable={true}
      showChips={true}
      clearable={true}
      onCreateOption={handleCreateOption}
    />
  );
};
```

## API Reference

### Types

```typescript
export type MultiSelectSize = 'xs' | 'sm' | 'md' | 'lg' | 'xl';
export type MultiSelectVariant = 'primary' | 'secondary' | 'outline' | 'ghost' | 'filled';
export type MultiSelectColor = 'primary' | 'success' | 'warning' | 'danger' | 'info';

export interface MultiSelectProps {
  // Required props
  label: string;
  options: SelectOption[];
  value: (string | number)[];
  onChange: (values: (string | number)[]) => void;
  
  // Optional props (see full reference above)
  // ...
}
```

### SelectOption Interface

```typescript
export interface SelectOption {
  value: string | number;
  label: string;
  isDisabled?: boolean;
  data?: any;
  icon?: React.ReactNode;
  description?: string;
}
```

---

## Support

For questions, issues, or contributions, please refer to the main design system documentation or contact the development team.

**Version**: 1.0.66  
**Last Updated**: December 2024  
**Component Status**: ✅ Production Ready
