# Autocomplete Component - Comprehensive Guide

## Overview

The Autocomplete component provides an input field with type-ahead suggestions and advanced filtering capabilities. It's designed for scenarios where users need to search and select from a large list of options.

## Features

### ✅ Core Features
- **Real-time filtering** as you type
- **Keyboard navigation** (Arrow keys, Enter, Escape)
- **Multiple sizes and variants** (xs, sm, md, lg, xl)
- **Color themes** (primary, success, warning, danger, info)
- **Option descriptions** and icons support
- **Create new options** functionality
- **Clear button** functionality
- **No results message** customization
- **Dropdown overflow protection** (z-index: 9999)

### ✅ Advanced Features
- **State corruption prevention** with key-based reset
- **Edit form support** with value preservation
- **Design system integration** with proper color tokens
- **Dark mode support** with consistent theming
- **Accessibility features** with proper ARIA attributes

## Installation & Import

```typescript
import { Autocomplete } from '@acutrack-bookprint/acutrack-ds';
import type { AutocompleteProps, AutocompleteSize, AutocompleteVariant, AutocompleteColor } from '@acutrack-bookprint/acutrack-ds';
```

## Basic Usage

```typescript
import React, { useState } from 'react';
import { Autocomplete } from '@acutrack-bookprint/acutrack-ds';

const MyComponent = () => {
  const [selectedValue, setSelectedValue] = useState<string | number>('');

  const options = [
    { value: 'apple', label: 'Apple', description: 'A red fruit' },
    { value: 'banana', label: 'Banana', description: 'A yellow fruit' },
    { value: 'cherry', label: 'Cherry', description: 'A small red fruit' }
  ];

  return (
    <Autocomplete
      label="Select Fruit"
      id="fruit-autocomplete"
      options={options}
      value={selectedValue}
      onChange={setSelectedValue}
      placeholder="Type to search fruits..."
      showDescriptions={true}
    />
  );
};
```

## Props Reference

### Required Props

| Prop | Type | Description |
|------|------|-------------|
| `label` | `string` | The label text displayed above the autocomplete field |
| `id` | `string` | Unique identifier for the autocomplete field |
| `options` | `SelectOption[]` | Array of options to display in the dropdown |
| `value` | `string \| number` | The currently selected value |
| `onChange` | `(value: string \| number \| '') => void` | Callback function when the selection changes |

### Optional Props

#### Appearance & Styling
| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `size` | `AutocompleteSize` | `'md'` | Size of the autocomplete field (xs, sm, md, lg, xl) |
| `variant` | `AutocompleteVariant` | `'primary'` | Visual variant (primary, secondary, outline, ghost, filled) |
| `color` | `AutocompleteColor` | `'primary'` | Color theme (primary, success, warning, danger, info) |
| `placeholder` | `string` | `'Type to search...'` | Placeholder text for the input field |
| `isFullWidth` | `boolean` | `false` | Whether the autocomplete should take full width |
| `width` | `'sm' \| 'md' \| 'lg' \| 'full' \| 'auto' \| 'none'` | `undefined` | Width of the autocomplete field |
| `minWidth` | `string` | `undefined` | Minimum width override |
| `maxWidth` | `string` | `undefined` | Maximum width override |

#### State & Behavior
| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `isDisabled` | `boolean` | `false` | Whether the autocomplete field is disabled |
| `isRequired` | `boolean` | `false` | Whether the autocomplete field is required |
| `isLoading` | `boolean` | `false` | Whether the autocomplete field is in a loading state |
| `hasFiltering` | `boolean` | `true` | Whether the autocomplete should filter options as you type |
| `hasHighlighting` | `boolean` | `true` | Whether the autocomplete should highlight matching text |
| `closeOnSelection` | `boolean` | `true` | Whether the autocomplete should close on selection |
| `closeOnBlur` | `boolean` | `true` | Whether the autocomplete should close on blur |
| `closeOnEscape` | `boolean` | `true` | Whether the autocomplete should close on escape |

#### Display Options
| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `showDescriptions` | `boolean` | `false` | Whether to show option descriptions |
| `showIcons` | `boolean` | `false` | Whether to show option icons |
| `showClearButton` | `boolean` | `true` | Whether to show a clear button |
| `showLoadingSpinner` | `boolean` | `true` | Whether to show a loading spinner |
| `showNoResultsMessage` | `boolean` | `true` | Whether to show a no results message |
| `showCreateOption` | `boolean` | `false` | Whether to show a create option |
| `showSearchIcon` | `boolean` | `false` | Whether to show a search icon |
| `showDropdownArrow` | `boolean` | `true` | Whether to show a dropdown arrow |

#### Filtering & Search
| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `isCaseSensitive` | `boolean` | `false` | Whether the autocomplete should be case sensitive |
| `matchFromStart` | `boolean` | `false` | Whether the autocomplete should match from start |
| `matchWholeWords` | `boolean` | `false` | Whether the autocomplete should match whole words |
| `useFuzzySearch` | `boolean` | `false` | Whether the autocomplete should use fuzzy search |
| `maxOptions` | `number` | `10` | Maximum number of options to display |
| `minCharsToFilter` | `number` | `1` | Minimum characters to start filtering |
| `filterDebounceMs` | `number` | `300` | Debounce delay for filtering in milliseconds |

#### Messages & Text
| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `helperText` | `string` | `undefined` | Helper text to display below the autocomplete field |
| `error` | `string` | `undefined` | Error message to display below the autocomplete field |
| `description` | `string` | `undefined` | Description text to display below the label |
| `noResultsMessage` | `string` | `'No results found'` | Custom no results message |
| `createOptionText` | `string` | `'Create "{query}"'` | Custom create option text |

#### Callbacks
| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `onCreateOption` | `(value: string) => void` | `undefined` | Callback when creating a new option |
| `onDropdownOpen` | `() => void` | `undefined` | Callback when the dropdown opens |
| `onDropdownClose` | `() => void` | `undefined` | Callback when the dropdown closes |
| `onFilter` | `(query: string, options: SelectOption[]) => SelectOption[]` | `undefined` | Callback when filtering options |

## Advanced Usage Examples

### 1. Edit Form with Value Preservation

```typescript
import React, { useState } from 'react';
import { Autocomplete } from '@acutrack-bookprint/acutrack-ds';

const EditForm = () => {
  const [isEditMode, setIsEditMode] = useState(false);
  const [formData, setFormData] = useState({
    fruit: 'apple', // Existing data from API
  });

  // Helper function for key-based reset
  const getAutocompleteKey = (id: string, isDisabled: boolean, value: string | number, isEditMode?: boolean) => {
    return `autocomplete-${id}-${isDisabled ? 'disabled' : 'enabled'}-${value}-${isEditMode ? 'edit' : 'view'}`;
  };

  const handleEditClick = () => {
    setIsEditMode(true);
    // formData.fruit already contains existing value - no reset needed!
  };

  const handleSaveClick = () => {
    setIsEditMode(false);
    // Save data to API
    console.log('Saving data:', formData);
  };

  return (
    <div>
      <div className="flex gap-2 mb-4">
        <button onClick={handleEditClick} disabled={isEditMode}>
          Edit
        </button>
        <button onClick={handleSaveClick} disabled={!isEditMode}>
          Save
        </button>
      </div>

      <Autocomplete
        key={getAutocompleteKey("fruit-autocomplete", !isEditMode, formData.fruit, isEditMode)}
        label="Fruit Selection"
        id="fruit-autocomplete"
        options={fruitOptions}
        value={formData.fruit}
        onChange={(value) => setFormData(prev => ({ ...prev, fruit: value }))}
        isDisabled={!isEditMode}
        showDescriptions={true}
      />
    </div>
  );
};
```

### 2. With Icons and Descriptions

```typescript
const optionsWithIcons = [
  { 
    value: 'react', 
    label: 'React', 
    icon: <Icon size="sm">code</Icon>,
    description: 'JavaScript library'
  },
  { 
    value: 'vue', 
    label: 'Vue.js', 
    icon: <Icon size="sm">view_module</Icon>,
    description: 'Progressive framework'
  }
];

<Autocomplete
  label="Select Framework"
  id="framework-autocomplete"
  options={optionsWithIcons}
  value={selectedFramework}
  onChange={setSelectedFramework}
  showIcons={true}
  showDescriptions={true}
  placeholder="Choose a framework..."
/>
```

### 3. With Create Option

```typescript
const handleCreateOption = (value: string) => {
  console.log('Creating new option:', value);
  // Add to options list or save to API
};

<Autocomplete
  label="Add New Item"
  id="create-autocomplete"
  options={existingOptions}
  value={selectedValue}
  onChange={setSelectedValue}
  showCreateOption={true}
  createOptionText="Add '{query}'"
  onCreateOption={handleCreateOption}
  placeholder="Type to search or create new..."
/>
```

### 4. Custom Filtering

```typescript
const customFilter = (query: string, options: SelectOption[]) => {
  // Custom filtering logic
  return options.filter(option => 
    option.label.toLowerCase().includes(query.toLowerCase()) ||
    option.description?.toLowerCase().includes(query.toLowerCase())
  );
};

<Autocomplete
  label="Custom Filter"
  id="custom-filter-autocomplete"
  options={options}
  value={selectedValue}
  onChange={setSelectedValue}
  onFilter={customFilter}
  placeholder="Custom filtering enabled..."
/>
```

## State Management & Key-Based Reset

### The Problem
Autocomplete components maintain complex internal state that can get corrupted when props change, especially when switching between disabled/enabled states.

### The Solution
Use key-based reset to force component re-mounting when critical props change:

```typescript
// Helper function
const getAutocompleteKey = (id: string, isDisabled: boolean, value: string | number, isEditMode?: boolean) => {
  return `autocomplete-${id}-${isDisabled ? 'disabled' : 'enabled'}-${value}-${isEditMode ? 'edit' : 'view'}`;
};

// Usage
<Autocomplete
  key={getAutocompleteKey("my-autocomplete", isDisabled, currentValue, isEditMode)}
  // ... other props
/>
```

### Benefits
- ✅ **Prevents state corruption** when switching modes
- ✅ **Preserves existing values** during re-mounting
- ✅ **Clean component state** for reliable behavior
- ✅ **Perfect for edit forms** where data needs to be preserved

## Design System Integration

### Color Themes
The Autocomplete component uses design system color tokens:

```typescript
// Available colors
type AutocompleteColor = 'primary' | 'success' | 'warning' | 'danger' | 'info';

// Color mapping
'primary' → brand-orange colors
'success' → system-success colors  
'warning' → system-warning colors
'danger' → system-error colors
'info' → system-info colors
```

### Dark Mode Support
All colors automatically adapt to dark mode:

```typescript
// Light mode
bg-bg-secondary text-text-primary border-border-color

// Dark mode  
bg-dark-bg-secondary text-dark-text-primary border-dark-border-color
```

## Accessibility Features

### Keyboard Navigation
- **Arrow Down/Up**: Navigate through options
- **Enter**: Select highlighted option or create new option
- **Escape**: Close dropdown
- **Tab**: Move focus away from component

### ARIA Attributes
- Proper `aria-label` and `aria-describedby` attributes
- Screen reader support for option descriptions
- Focus management for dropdown interactions

## Performance Considerations

### Debouncing
Filtering is debounced by default (300ms) to prevent excessive API calls:

```typescript
<Autocomplete
  filterDebounceMs={500} // Custom debounce delay
  // ... other props
/>
```

### Option Limiting
Limit displayed options to prevent performance issues:

```typescript
<Autocomplete
  maxOptions={20} // Show maximum 20 options
  // ... other props
/>
```

## Troubleshooting

### Common Issues

#### 1. State Corruption After Disable/Enable
**Problem**: Component behaves strangely after being disabled and enabled
**Solution**: Use key-based reset
```typescript
<Autocomplete
  key={`autocomplete-${id}-${isDisabled ? 'disabled' : 'enabled'}`}
  // ... other props
/>
```

#### 2. Full-Width Behavior
**Feature**: Autocomplete automatically takes full width of its parent container
**Implementation**: The component uses `w-full` by default and dropdowns use `w-full` styling
```typescript
// ✅ Automatically takes full width
<div className="w-full"> {/* Parent container */}
  <Autocomplete ... /> {/* Takes full width automatically */}
</div>

// ✅ Dropdown also takes full width
<Autocomplete 
  // Dropdown automatically uses w-full styling
  // No additional configuration needed
/>
```

#### 3. Dropdown Hidden Behind Other Elements
**Problem**: Dropdown appears behind other components
**Solution**: Ensure parent containers have `overflowVisible={true}`
```typescript
<Card overflowVisible={true}>
  <Autocomplete ... />
</Card>
```

#### 3. Values Not Preserved in Edit Mode
**Problem**: Existing values disappear when entering edit mode
**Solution**: Ensure the `value` prop contains the existing data
```typescript
const [formData, setFormData] = useState({
  fruit: existingDataFromAPI // Make sure this contains the current value
});
```

## Migration Guide

### From Previous Versions

#### Breaking Changes
- **Key-based reset**: Now recommended for state management
- **Color tokens**: Updated to use design system tokens
- **Z-index**: Increased to 9999 for better dropdown visibility

#### Migration Steps
1. **Add key props** to components that toggle disabled state
2. **Update color references** to use design system tokens
3. **Test edit form scenarios** to ensure value preservation

## Best Practices

### 1. Use Key-Based Reset for Dynamic Components
```typescript
// ✅ Good - Prevents state corruption
<Autocomplete
  key={`autocomplete-${id}-${isDisabled ? 'disabled' : 'enabled'}`}
  isDisabled={isDisabled}
  // ... other props
/>

// ❌ Avoid - Can cause state corruption
<Autocomplete
  isDisabled={isDisabled}
  // ... other props
/>
```

### 2. Provide Meaningful Option Data
```typescript
// ✅ Good - Rich option data
const options = [
  { 
    value: 'react', 
    label: 'React', 
    description: 'JavaScript library for building user interfaces',
    icon: <Icon>code</Icon>
  }
];

// ❌ Avoid - Minimal option data
const options = [
  { value: 'react', label: 'React' }
];
```

### 3. Handle Loading States
```typescript
// ✅ Good - Show loading state
<Autocomplete
  isLoading={isLoading}
  options={isLoading ? [] : options}
  // ... other props
/>
```

### 4. Use Appropriate Sizes
```typescript
// ✅ Good - Appropriate sizing
<Autocomplete size="sm" /> // For compact forms
<Autocomplete size="lg" /> // For prominent selections
```

## Examples Gallery

### Basic Autocomplete
```typescript
<Autocomplete
  label="Select Country"
  id="country-autocomplete"
  options={countryOptions}
  value={selectedCountry}
  onChange={setSelectedCountry}
  placeholder="Type to search countries..."
/>
```

### Advanced Autocomplete with All Features
```typescript
<Autocomplete
  label="Select Technology"
  id="tech-autocomplete"
  options={techOptionsWithIcons}
  value={selectedTech}
  onChange={setSelectedTech}
  size="lg"
  variant="outline"
  color="success"
  showIcons={true}
  showDescriptions={true}
  showCreateOption={true}
  createOptionText="Add '{query}'"
  onCreateOption={handleCreateTech}
  placeholder="Search or add technology..."
  helperText="Select your preferred technology stack"
  maxOptions={15}
  filterDebounceMs={200}
/>
```

### Form Integration
```typescript
const UserForm = () => {
  const [formData, setFormData] = useState({
    name: '',
    country: '',
    skills: []
  });

  return (
    <form>
      <Autocomplete
        key={`country-${formData.country}`}
        label="Country"
        id="country"
        options={countryOptions}
        value={formData.country}
        onChange={(value) => setFormData(prev => ({ ...prev, country: value }))}
        isRequired={true}
        error={errors.country}
      />
      
      <Autocomplete
        key={`skills-${formData.skills.length}`}
        label="Primary Skill"
        id="primary-skill"
        options={skillOptions}
        value={formData.skills[0] || ''}
        onChange={(value) => setFormData(prev => ({ 
          ...prev, 
          skills: [value, ...prev.skills.slice(1)] 
        }))}
        showDescriptions={true}
      />
    </form>
  );
};
```

## API Reference

### Types

```typescript
export type AutocompleteSize = 'xs' | 'sm' | 'md' | 'lg' | 'xl';
export type AutocompleteVariant = 'primary' | 'secondary' | 'outline' | 'ghost' | 'filled';
export type AutocompleteColor = 'primary' | 'success' | 'warning' | 'danger' | 'info';
export type AutocompletePosition = 'bottom' | 'bottom-start' | 'bottom-end' | 'top' | 'top-start' | 'top-end' | 'left' | 'left-start' | 'left-end' | 'right' | 'right-start' | 'right-end';
export type AutocompleteAlignment = 'left' | 'center' | 'right';

export interface AutocompleteProps {
  // Required props
  label: string;
  id: string;
  options: SelectOption[];
  value: string | number;
  onChange: (value: string | number | '') => void;
  
  // Optional props (see full reference above)
  // ...
}
```

### SelectOption Interface

```typescript
export interface SelectOption {
  value: string | number;
  label: string;
  isDisabled?: boolean;
  data?: any;
  icon?: React.ReactNode;
  description?: string;
}
```

---

## Support

For questions, issues, or contributions, please refer to the main design system documentation or contact the development team.

**Version**: 1.0.66  
**Last Updated**: December 2024  
**Component Status**: ✅ Production Ready
